function cov_bo24uldxi(){var path="/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/job.js";var hash="bbac1064dd959fb27a9fea03474ccbf4adb77014";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/job.js",statementMap:{"0":{start:{line:1,column:18},end:{line:1,column:47}},"1":{start:{line:2,column:19},end:{line:2,column:49}},"2":{start:{line:3,column:15},end:{line:3,column:35}},"3":{start:{line:4,column:15},end:{line:4,column:36}},"4":{start:{line:5,column:10},end:{line:5,column:28}},"5":{start:{line:8,column:0},end:{line:8,column:26}},"6":{start:{line:9,column:22},end:{line:9,column:24}},"7":{start:{line:10,column:0},end:{line:104,column:1}},"8":{start:{line:13,column:8},end:{line:70,column:9}},"9":{start:{line:14,column:25},end:{line:14,column:27}},"10":{start:{line:16,column:25},end:{line:16,column:105}},"11":{start:{line:17,column:12},end:{line:22,column:12}},"12":{start:{line:18,column:16},end:{line:18,column:39}},"13":{start:{line:21,column:12},end:{line:21,column:44}},"14":{start:{line:24,column:26},end:{line:26,column:14}},"15":{start:{line:27,column:12},end:{line:34,column:13}},"16":{start:{line:28,column:16},end:{line:33,column:17}},"17":{start:{line:29,column:20},end:{line:29,column:95}},"18":{start:{line:32,column:20},end:{line:32,column:49}},"19":{start:{line:35,column:12},end:{line:63,column:13}},"20":{start:{line:36,column:16},end:{line:56,column:17}},"21":{start:{line:37,column:35},end:{line:37,column:181}},"22":{start:{line:38,column:20},end:{line:43,column:21}},"23":{start:{line:39,column:24},end:{line:39,column:99}},"24":{start:{line:42,column:24},end:{line:42,column:50}},"25":{start:{line:44,column:20},end:{line:44,column:45}},"26":{start:{line:45,column:20},end:{line:45,column:65}},"27":{start:{line:48,column:20},end:{line:53,column:21}},"28":{start:{line:49,column:24},end:{line:49,column:99}},"29":{start:{line:52,column:24},end:{line:52,column:51}},"30":{start:{line:55,column:20},end:{line:55,column:86}},"31":{start:{line:61,column:16},end:{line:61,column:98}},"32":{start:{line:66,column:12},end:{line:66,column:30}},"33":{start:{line:68,column:12},end:{line:68,column:56}},"34":{start:{line:74,column:8},end:{line:101,column:9}},"35":{start:{line:75,column:25},end:{line:75,column:105}},"36":{start:{line:77,column:28},end:{line:77,column:50}},"37":{start:{line:78,column:27},end:{line:78,column:44}},"38":{start:{line:79,column:25},end:{line:79,column:75}},"39":{start:{line:81,column:12},end:{line:84,column:13}},"40":{start:{line:82,column:16},end:{line:82,column:82}},"41":{start:{line:86,column:12},end:{line:86,column:97}},"42":{start:{line:87,column:12},end:{line:90,column:82}},"43":{start:{line:92,column:12},end:{line:92,column:32}},"44":{start:{line:94,column:12},end:{line:94,column:55}},"45":{start:{line:97,column:12},end:{line:97,column:30}},"46":{start:{line:99,column:12},end:{line:99,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:13},end:{line:12,column:14}},loc:{start:{line:12,column:48},end:{line:72,column:5}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:181},end:{line:24,column:182}},loc:{start:{line:24,column:187},end:{line:26,column:13}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:73,column:12},end:{line:73,column:13}},loc:{start:{line:73,column:47},end:{line:103,column:5}},line:73}},branchMap:{"0":{loc:{start:{line:17,column:12},end:{line:22,column:12}},type:"if",locations:[{start:{line:17,column:12},end:{line:22,column:12}},{start:{line:17,column:12},end:{line:22,column:12}}],line:17},"1":{loc:{start:{line:17,column:15},end:{line:17,column:110}},type:"binary-expr",locations:[{start:{line:17,column:15},end:{line:17,column:44}},{start:{line:17,column:47},end:{line:17,column:81}},{start:{line:17,column:83},end:{line:17,column:110}}],line:17},"2":{loc:{start:{line:27,column:12},end:{line:34,column:13}},type:"if",locations:[{start:{line:27,column:12},end:{line:34,column:13}},{start:{line:27,column:12},end:{line:34,column:13}}],line:27},"3":{loc:{start:{line:35,column:12},end:{line:63,column:13}},type:"if",locations:[{start:{line:35,column:12},end:{line:63,column:13}},{start:{line:35,column:12},end:{line:63,column:13}}],line:35},"4":{loc:{start:{line:81,column:12},end:{line:84,column:13}},type:"if",locations:[{start:{line:81,column:12},end:{line:84,column:13}},{start:{line:81,column:12},end:{line:84,column:13}}],line:81},"5":{loc:{start:{line:87,column:12},end:{line:90,column:82}},type:"cond-expr",locations:[{start:{line:88,column:12},end:{line:88,column:112}},{start:{line:90,column:12},end:{line:90,column:82}}],line:87}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bbac1064dd959fb27a9fea03474ccbf4adb77014"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_bo24uldxi=function(){return actualCoverage;};}return actualCoverage;}cov_bo24uldxi();const jobModels=(cov_bo24uldxi().s[0]++,require('../models/jobModel'));const authModels=(cov_bo24uldxi().s[1]++,require('../models/authModel'));const{Op}=(cov_bo24uldxi().s[2]++,require("sequelize"));const helper=(cov_bo24uldxi().s[3]++,require('../helpers'));const e=(cov_bo24uldxi().s[4]++,require('express'));// const { delete } = require('../../app')
cov_bo24uldxi().s[5]++;require('dotenv').config();const refreshTokens=(cov_bo24uldxi().s[6]++,[]);cov_bo24uldxi().s[7]++;module.exports={getJobs:async function(request,response){cov_bo24uldxi().f[0]++;cov_bo24uldxi().s[8]++;try{let location=(cov_bo24uldxi().s[9]++,'');const user=(cov_bo24uldxi().s[10]++,await authModels.findOne({where:{username:request.token.result.username}}));cov_bo24uldxi().s[11]++;if((cov_bo24uldxi().b[1][0]++,request.query.location===null)||(cov_bo24uldxi().b[1][1]++,request.query.location===undefined)||(cov_bo24uldxi().b[1][2]++,request.query.location==='')){cov_bo24uldxi().b[0][0]++;cov_bo24uldxi().s[12]++;location=user.location;}else{cov_bo24uldxi().b[0][1]++;cov_bo24uldxi().s[13]++;location=request.query.location;}//    console.log(location)
const check=(cov_bo24uldxi().s[14]++,await jobModels.findAll({where:{location:{[Op.like]:`%${location}%`},availability:user.availability,user_id:user.id,isClaimed:'false'}}).then(data=>{cov_bo24uldxi().f[1]++;}));cov_bo24uldxi().s[15]++;if(check.length>5){cov_bo24uldxi().b[2][0]++;cov_bo24uldxi().s[16]++;try{cov_bo24uldxi().s[17]++;await jobModels.update({user_id:null},{where:{user_id:user.id}});}catch(error){cov_bo24uldxi().s[18]++;console.log('no more jobsss');}}else{cov_bo24uldxi().b[2][1]++;}cov_bo24uldxi().s[19]++;if(user.other_appointment==="none"){cov_bo24uldxi().b[3][0]++;cov_bo24uldxi().s[20]++;try{const result=(cov_bo24uldxi().s[21]++,await jobModels.findOne({where:{location:{[Op.like]:`%${location}%`},availability:user.availability,user_id:null,isClaimed:'false'}}));cov_bo24uldxi().s[22]++;try{cov_bo24uldxi().s[23]++;await jobModels.update({user_id:user.id},{where:{id:result.id}});}catch(error){cov_bo24uldxi().s[24]++;console.log('no more job');}cov_bo24uldxi().s[25]++;result.user_id=user.id;cov_bo24uldxi().s[26]++;return helper.response(response,200,result);}catch(error){cov_bo24uldxi().s[27]++;// if data has reach end, then clear user_id on job for reset mark.
try{cov_bo24uldxi().s[28]++;await jobModels.update({user_id:null},{where:{user_id:user.id}});}catch(error){cov_bo24uldxi().s[29]++;console.log('no more jobs');}cov_bo24uldxi().s[30]++;return helper.response(response,200,{message:'no more jobs'});}}else{cov_bo24uldxi().b[3][1]++;cov_bo24uldxi().s[31]++;return helper.response(response,404,{message:'you have another appointment'});}}catch(error){cov_bo24uldxi().s[32]++;console.log(error);cov_bo24uldxi().s[33]++;return helper.response(response,500,error);}},putJob:async function(request,response){cov_bo24uldxi().f[2]++;cov_bo24uldxi().s[34]++;try{const user=(cov_bo24uldxi().s[35]++,await authModels.findOne({where:{username:request.token.result.username}}));// if(user.other_appointment==="none"){
let isClaimed=(cov_bo24uldxi().s[36]++,request.body.isClaimed);const job_id=(cov_bo24uldxi().s[37]++,request.params.id);const data=(cov_bo24uldxi().s[38]++,await jobModels.findOne({where:{id:job_id}}));cov_bo24uldxi().s[39]++;if(request.token.result.id!==data.user_id){cov_bo24uldxi().b[4][0]++;cov_bo24uldxi().s[40]++;return helper.response(response,401,{message:"unauthorized"});}else{cov_bo24uldxi().b[4][1]++;}cov_bo24uldxi().s[41]++;jobModels.update({user_id:null,isClaimed:isClaimed},{where:{id:job_id}});cov_bo24uldxi().s[42]++;isClaimed===true?(cov_bo24uldxi().b[5][0]++,authModels.update({other_appointment:data.name,isClaimed:isClaimed},{where:{id:job_id}})):(cov_bo24uldxi().b[5][1]++,authModels.update({isClaimed:isClaimed},{where:{id:job_id}}));// result.user_id=user.id;
cov_bo24uldxi().s[43]++;data.user_id=null;cov_bo24uldxi().s[44]++;return helper.response(response,200,data);}catch(error){cov_bo24uldxi().s[45]++;console.log(error);cov_bo24uldxi().s[46]++;return helper.response(response,500,error);}}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvYi5qcyJdLCJuYW1lcyI6WyJqb2JNb2RlbHMiLCJyZXF1aXJlIiwiYXV0aE1vZGVscyIsIk9wIiwiaGVscGVyIiwiZSIsImNvbmZpZyIsInJlZnJlc2hUb2tlbnMiLCJtb2R1bGUiLCJleHBvcnRzIiwiZ2V0Sm9icyIsInJlcXVlc3QiLCJyZXNwb25zZSIsImxvY2F0aW9uIiwidXNlciIsImZpbmRPbmUiLCJ3aGVyZSIsInVzZXJuYW1lIiwidG9rZW4iLCJyZXN1bHQiLCJxdWVyeSIsInVuZGVmaW5lZCIsImNoZWNrIiwiZmluZEFsbCIsImxpa2UiLCJhdmFpbGFiaWxpdHkiLCJ1c2VyX2lkIiwiaWQiLCJpc0NsYWltZWQiLCJ0aGVuIiwiZGF0YSIsImxlbmd0aCIsInVwZGF0ZSIsImVycm9yIiwiY29uc29sZSIsImxvZyIsIm90aGVyX2FwcG9pbnRtZW50IiwibWVzc2FnZSIsInB1dEpvYiIsImJvZHkiLCJqb2JfaWQiLCJwYXJhbXMiLCJuYW1lIl0sIm1hcHBpbmdzIjoiOHdLQWVZO3lGQWZaLEtBQU1BLENBQUFBLFNBQVMseUJBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFWLENBQWYsQ0FDQSxLQUFNQyxDQUFBQSxVQUFVLHlCQUFHRCxPQUFPLENBQUMscUJBQUQsQ0FBVixDQUFoQixDQUNBLEtBQU0sQ0FBRUUsRUFBRiwwQkFBU0YsT0FBTyxDQUFDLFdBQUQsQ0FBaEIsQ0FBTixDQUNBLEtBQU1HLENBQUFBLE1BQU0seUJBQUdILE9BQU8sQ0FBQyxZQUFELENBQVYsQ0FBWixDQUNBLEtBQU1JLENBQUFBLENBQUMseUJBQUdKLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBUCxDQUNBO3VCQUVBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCSyxNQUFsQixHQUNBLEtBQU1DLENBQUFBLGFBQWEseUJBQUcsRUFBSCxDQUFuQixDLHVCQUNBQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FFYkMsT0FBTyxDQUFFLGVBQWdCQyxPQUFoQixDQUF5QkMsUUFBekIs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QUFQLENBQWdCQSxRQUFoQixDQUEwQixHQUExQixDQUErQmtCLElBQS9CLENBQVAsQ0FFSCxDQUFDLE1BQU9HLEtBQVAsQ0FBYyx5QkFDWkMsT0FBTyxDQUFDQyxHQUFSLENBQVlGLEtBQVosRUFEWSx3QkFHWixNQUFPN0IsQ0FBQUEsTUFBTSxDQUFDUSxRQUFQLENBQWdCQSxRQUFoQixDQUEwQixHQUExQixDQUErQnFCLEtBQS9CLENBQVAsQ0FFSCxDQUVKLENBN0ZZLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgam9iTW9kZWxzID0gcmVxdWlyZSgnLi4vbW9kZWxzL2pvYk1vZGVsJylcbmNvbnN0IGF1dGhNb2RlbHMgPSByZXF1aXJlKCcuLi9tb2RlbHMvYXV0aE1vZGVsJylcbmNvbnN0IHsgT3AgfSA9IHJlcXVpcmUoXCJzZXF1ZWxpemVcIik7XG5jb25zdCBoZWxwZXIgPSByZXF1aXJlKCcuLi9oZWxwZXJzJylcbmNvbnN0IGUgPSByZXF1aXJlKCdleHByZXNzJylcbi8vIGNvbnN0IHsgZGVsZXRlIH0gPSByZXF1aXJlKCcuLi8uLi9hcHAnKVxuXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKVxuY29uc3QgcmVmcmVzaFRva2VucyA9IFtdXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIGdldEpvYnM6IGFzeW5jIGZ1bmN0aW9uIChyZXF1ZXN0LCByZXNwb25zZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IGxvY2F0aW9uPScnO1xuICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoTW9kZWxzLmZpbmRPbmUoeyB3aGVyZTogeyB1c2VybmFtZTogcmVxdWVzdC50b2tlbi5yZXN1bHQudXNlcm5hbWUgfSB9KTtcbiAgICAgICAgICAgIGlmKHJlcXVlc3QucXVlcnkubG9jYXRpb249PT1udWxsfHwgcmVxdWVzdC5xdWVyeS5sb2NhdGlvbj09PXVuZGVmaW5lZHx8cmVxdWVzdC5xdWVyeS5sb2NhdGlvbj09PScnKXtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbj11c2VyLmxvY2F0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgbG9jYXRpb249cmVxdWVzdC5xdWVyeS5sb2NhdGlvbjtcbiAgICAgICAgICAgfVxuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhsb2NhdGlvbilcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrID0gYXdhaXQgam9iTW9kZWxzLmZpbmRBbGwoeyB3aGVyZTogeyBsb2NhdGlvbjogeyBbT3AubGlrZV06YCUke2xvY2F0aW9ufSVgfSwgYXZhaWxhYmlsaXR5OiB1c2VyLmF2YWlsYWJpbGl0eSwgdXNlcl9pZDogdXNlci5pZCwgaXNDbGFpbWVkOiAnZmFsc2UnIH0gfSkudGhlbihkYXRhPT57XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgaWYgKGNoZWNrLmxlbmd0aCA+IDUpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBqb2JNb2RlbHMudXBkYXRlKHsgdXNlcl9pZDogbnVsbCB9LCB7IHdoZXJlOiB7IHVzZXJfaWQ6IHVzZXIuaWQgfSB9KTtcblxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBtb3JlIGpvYnNzcycpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHVzZXIub3RoZXJfYXBwb2ludG1lbnQgPT09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgam9iTW9kZWxzLmZpbmRPbmUoeyB3aGVyZTogeyBsb2NhdGlvbjogeyBbT3AubGlrZV06YCUke2xvY2F0aW9ufSVgfSwgYXZhaWxhYmlsaXR5OiB1c2VyLmF2YWlsYWJpbGl0eSwgdXNlcl9pZDogbnVsbCwgaXNDbGFpbWVkOiAnZmFsc2UnIH0gfSk7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBqb2JNb2RlbHMudXBkYXRlKHsgdXNlcl9pZDogdXNlci5pZCB9LCB7IHdoZXJlOiB7IGlkOiByZXN1bHQuaWQgfSB9KTtcblxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIG1vcmUgam9iJylcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXN1bHQudXNlcl9pZCA9IHVzZXIuaWQ7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDIwMCwgcmVzdWx0KVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGRhdGEgaGFzIHJlYWNoIGVuZCwgdGhlbiBjbGVhciB1c2VyX2lkIG9uIGpvYiBmb3IgcmVzZXQgbWFyay5cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGpvYk1vZGVscy51cGRhdGUoeyB1c2VyX2lkOiBudWxsIH0sIHsgd2hlcmU6IHsgdXNlcl9pZDogdXNlci5pZCB9IH0pO1xuICAgIFxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIG1vcmUgam9icycpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCB7IG1lc3NhZ2U6ICdubyBtb3JlIGpvYnMnIH0pXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwNCwgeyBtZXNzYWdlOiAneW91IGhhdmUgYW5vdGhlciBhcHBvaW50bWVudCcgfSlcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuICAgIHB1dEpvYjogYXN5bmMgZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aE1vZGVscy5maW5kT25lKHsgd2hlcmU6IHsgdXNlcm5hbWU6IHJlcXVlc3QudG9rZW4ucmVzdWx0LnVzZXJuYW1lIH0gfSk7XG4gICAgICAgICAgICAvLyBpZih1c2VyLm90aGVyX2FwcG9pbnRtZW50PT09XCJub25lXCIpe1xuICAgICAgICAgICAgbGV0IGlzQ2xhaW1lZCA9IHJlcXVlc3QuYm9keS5pc0NsYWltZWQ7XG4gICAgICAgICAgICBjb25zdCBqb2JfaWQgPSByZXF1ZXN0LnBhcmFtcy5pZDtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBqb2JNb2RlbHMuZmluZE9uZSh7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KTtcblxuICAgICAgICAgICAgaWYgKHJlcXVlc3QudG9rZW4ucmVzdWx0LmlkICE9PSBkYXRhLnVzZXJfaWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA0MDEsIHsgbWVzc2FnZTogXCJ1bmF1dGhvcml6ZWRcIiB9KVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGpvYk1vZGVscy51cGRhdGUoeyB1c2VyX2lkOiBudWxsLCBpc0NsYWltZWQ6IGlzQ2xhaW1lZCB9LCB7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KTtcbiAgICAgICAgICAgIGlzQ2xhaW1lZD09PXRydWU/IFxuICAgICAgICAgICAgYXV0aE1vZGVscy51cGRhdGUoeyBvdGhlcl9hcHBvaW50bWVudDogZGF0YS5uYW1lLCBpc0NsYWltZWQ6IGlzQ2xhaW1lZCB9LCB7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KVxuICAgICAgICAgICAgOlxuICAgICAgICAgICAgYXV0aE1vZGVscy51cGRhdGUoeyBpc0NsYWltZWQ6IGlzQ2xhaW1lZCB9LCB7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KVxuICAgICAgICAgICAgLy8gcmVzdWx0LnVzZXJfaWQ9dXNlci5pZDtcbiAgICAgICAgICAgIGRhdGEudXNlcl9pZCA9IG51bGw7XG5cbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDIwMCwgZGF0YSlcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXG5cbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDUwMCwgZXJyb3IpXG5cbiAgICAgICAgfVxuXG4gICAgfSxcbn1cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4iXX0=