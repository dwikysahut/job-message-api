function cov_bo24uldxi(){var path="/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/job.js";var hash="b502346ecd7826d1c1c1c60ae981433e562d3140";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/job.js",statementMap:{"0":{start:{line:1,column:18},end:{line:1,column:47}},"1":{start:{line:2,column:19},end:{line:2,column:49}},"2":{start:{line:3,column:15},end:{line:3,column:35}},"3":{start:{line:4,column:15},end:{line:4,column:36}},"4":{start:{line:5,column:10},end:{line:5,column:28}},"5":{start:{line:8,column:0},end:{line:8,column:26}},"6":{start:{line:9,column:22},end:{line:9,column:24}},"7":{start:{line:10,column:0},end:{line:150,column:1}},"8":{start:{line:13,column:8},end:{line:96,column:9}},"9":{start:{line:14,column:27},end:{line:14,column:29}},"10":{start:{line:15,column:26},end:{line:15,column:36}},"11":{start:{line:16,column:28},end:{line:16,column:46}},"12":{start:{line:18,column:12},end:{line:20,column:13}},"13":{start:{line:19,column:16},end:{line:19,column:109}},"14":{start:{line:21,column:25},end:{line:21,column:105}},"15":{start:{line:22,column:12},end:{line:27,column:13}},"16":{start:{line:23,column:16},end:{line:23,column:41}},"17":{start:{line:26,column:16},end:{line:26,column:50}},"18":{start:{line:33,column:24},end:{line:39,column:14}},"19":{start:{line:41,column:26},end:{line:41,column:177}},"20":{start:{line:42,column:12},end:{line:49,column:13}},"21":{start:{line:43,column:16},end:{line:48,column:17}},"22":{start:{line:44,column:20},end:{line:44,column:95}},"23":{start:{line:47,column:20},end:{line:47,column:49}},"24":{start:{line:50,column:12},end:{line:89,column:13}},"25":{start:{line:51,column:16},end:{line:82,column:17}},"26":{start:{line:52,column:35},end:{line:52,column:183}},"27":{start:{line:55,column:20},end:{line:63,column:21}},"28":{start:{line:55,column:33},end:{line:55,column:34}},"29":{start:{line:57,column:24},end:{line:62,column:25}},"30":{start:{line:59,column:28},end:{line:61,column:30}},"31":{start:{line:60,column:32},end:{line:60,column:52}},"32":{start:{line:64,column:20},end:{line:69,column:21}},"33":{start:{line:65,column:24},end:{line:65,column:99}},"34":{start:{line:68,column:24},end:{line:68,column:50}},"35":{start:{line:70,column:20},end:{line:70,column:45}},"36":{start:{line:71,column:20},end:{line:71,column:65}},"37":{start:{line:74,column:20},end:{line:79,column:21}},"38":{start:{line:75,column:24},end:{line:75,column:99}},"39":{start:{line:78,column:24},end:{line:78,column:51}},"40":{start:{line:81,column:20},end:{line:81,column:86}},"41":{start:{line:87,column:16},end:{line:87,column:98}},"42":{start:{line:92,column:12},end:{line:92,column:30}},"43":{start:{line:94,column:12},end:{line:94,column:56}},"44":{start:{line:100,column:8},end:{line:133,column:9}},"45":{start:{line:101,column:25},end:{line:101,column:105}},"46":{start:{line:103,column:28},end:{line:103,column:50}},"47":{start:{line:104,column:27},end:{line:104,column:44}},"48":{start:{line:105,column:25},end:{line:105,column:75}},"49":{start:{line:106,column:12},end:{line:106,column:47}},"50":{start:{line:108,column:12},end:{line:111,column:13}},"51":{start:{line:109,column:16},end:{line:109,column:86}},"52":{start:{line:112,column:12},end:{line:112,column:97}},"53":{start:{line:113,column:12},end:{line:122,column:13}},"54":{start:{line:114,column:16},end:{line:114,column:95}},"55":{start:{line:116,column:16},end:{line:116,column:85}},"56":{start:{line:120,column:16},end:{line:120,column:85}},"57":{start:{line:124,column:12},end:{line:124,column:32}},"58":{start:{line:126,column:12},end:{line:126,column:55}},"59":{start:{line:129,column:12},end:{line:129,column:30}},"60":{start:{line:131,column:12},end:{line:131,column:56}},"61":{start:{line:137,column:8},end:{line:147,column:9}},"62":{start:{line:138,column:28},end:{line:138,column:40}},"63":{start:{line:140,column:27},end:{line:140,column:58}},"64":{start:{line:141,column:12},end:{line:141,column:57}},"65":{start:{line:145,column:12},end:{line:145,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:13},end:{line:12,column:14}},loc:{start:{line:12,column:48},end:{line:98,column:5}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:59,column:116},end:{line:59,column:117}},loc:{start:{line:59,column:133},end:{line:61,column:29}},line:59},"2":{name:"(anonymous_2)",decl:{start:{line:99,column:12},end:{line:99,column:13}},loc:{start:{line:99,column:47},end:{line:135,column:5}},line:99},"3":{name:"(anonymous_3)",decl:{start:{line:136,column:13},end:{line:136,column:14}},loc:{start:{line:136,column:48},end:{line:149,column:5}},line:136}},branchMap:{"0":{loc:{start:{line:18,column:12},end:{line:20,column:13}},type:"if",locations:[{start:{line:18,column:12},end:{line:20,column:13}},{start:{line:18,column:12},end:{line:20,column:13}}],line:18},"1":{loc:{start:{line:22,column:12},end:{line:27,column:13}},type:"if",locations:[{start:{line:22,column:12},end:{line:27,column:13}},{start:{line:22,column:12},end:{line:27,column:13}}],line:22},"2":{loc:{start:{line:22,column:16},end:{line:22,column:120}},type:"binary-expr",locations:[{start:{line:22,column:16},end:{line:22,column:47}},{start:{line:22,column:51},end:{line:22,column:87}},{start:{line:22,column:91},end:{line:22,column:120}}],line:22},"3":{loc:{start:{line:42,column:12},end:{line:49,column:13}},type:"if",locations:[{start:{line:42,column:12},end:{line:49,column:13}},{start:{line:42,column:12},end:{line:49,column:13}}],line:42},"4":{loc:{start:{line:42,column:16},end:{line:42,column:41}},type:"binary-expr",locations:[{start:{line:42,column:16},end:{line:42,column:21}},{start:{line:42,column:25},end:{line:42,column:41}}],line:42},"5":{loc:{start:{line:50,column:12},end:{line:89,column:13}},type:"if",locations:[{start:{line:50,column:12},end:{line:89,column:13}},{start:{line:50,column:12},end:{line:89,column:13}}],line:50},"6":{loc:{start:{line:57,column:24},end:{line:62,column:25}},type:"if",locations:[{start:{line:57,column:24},end:{line:62,column:25}},{start:{line:57,column:24},end:{line:62,column:25}}],line:57},"7":{loc:{start:{line:57,column:28},end:{line:57,column:126}},type:"binary-expr",locations:[{start:{line:57,column:28},end:{line:57,column:42}},{start:{line:57,column:46},end:{line:57,column:99}},{start:{line:57,column:103},end:{line:57,column:126}}],line:57},"8":{loc:{start:{line:108,column:12},end:{line:111,column:13}},type:"if",locations:[{start:{line:108,column:12},end:{line:111,column:13}},{start:{line:108,column:12},end:{line:111,column:13}}],line:108},"9":{loc:{start:{line:113,column:12},end:{line:122,column:13}},type:"if",locations:[{start:{line:113,column:12},end:{line:122,column:13}},{start:{line:113,column:12},end:{line:122,column:13}}],line:113}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b502346ecd7826d1c1c1c60ae981433e562d3140"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_bo24uldxi=function(){return actualCoverage;};}return actualCoverage;}cov_bo24uldxi();const jobModels=(cov_bo24uldxi().s[0]++,require('../models/jobModel'));const authModels=(cov_bo24uldxi().s[1]++,require('../models/authModel'));const{Op}=(cov_bo24uldxi().s[2]++,require("sequelize"));const helper=(cov_bo24uldxi().s[3]++,require('../helpers'));const e=(cov_bo24uldxi().s[4]++,require('express'));// const { delete } = require('../../app')
cov_bo24uldxi().s[5]++;require('dotenv').config();const refreshTokens=(cov_bo24uldxi().s[6]++,[]);cov_bo24uldxi().s[7]++;module.exports={getJobs:async function(request,response){cov_bo24uldxi().f[0]++;cov_bo24uldxi().s[8]++;try{let location=(cov_bo24uldxi().s[9]++,'');let date_ob=(cov_bo24uldxi().s[10]++,new Date());let thisHours=(cov_bo24uldxi().s[11]++,date_ob.getHours());//open at 8 am
cov_bo24uldxi().s[12]++;if(thisHours<8){cov_bo24uldxi().b[0][0]++;cov_bo24uldxi().s[13]++;return helper.response(response,401,{message:'jobs still closed, and will Open at 8am'});}else{cov_bo24uldxi().b[0][1]++;}const user=(cov_bo24uldxi().s[14]++,await authModels.findOne({where:{username:request.token.result.username}}));cov_bo24uldxi().s[15]++;if((cov_bo24uldxi().b[2][0]++,request.query.location===null)||(cov_bo24uldxi().b[2][1]++,request.query.location===undefined)||(cov_bo24uldxi().b[2][2]++,request.query.location==='')){cov_bo24uldxi().b[1][0]++;cov_bo24uldxi().s[16]++;location=user.location;}else{cov_bo24uldxi().b[1][1]++;cov_bo24uldxi().s[17]++;location=request.query.location;}// current hours
// let minutes = date_ob.getMinutes();
// let second = date_ob.getSeconds();
const all=(cov_bo24uldxi().s[18]++,await jobModels.findAll({where:{location:{[Op.like]:`%${location}%`},availability:user.availability,user_id:{[Op.ne]:null},isClaimed:'false'}}));const check=(cov_bo24uldxi().s[19]++,await jobModels.findAll({where:{location:{[Op.like]:`%${location}%`},availability:user.availability,user_id:user.id,isClaimed:'false'}}));cov_bo24uldxi().s[20]++;if((cov_bo24uldxi().b[4][0]++,check)&&(cov_bo24uldxi().b[4][1]++,check.length>5)){cov_bo24uldxi().b[3][0]++;cov_bo24uldxi().s[21]++;try{cov_bo24uldxi().s[22]++;await jobModels.update({user_id:null},{where:{user_id:user.id}});}catch(error){cov_bo24uldxi().s[23]++;console.log('no more jobsss');}}else{cov_bo24uldxi().b[3][1]++;}cov_bo24uldxi().s[24]++;if(user.other_appointment==="none"){cov_bo24uldxi().b[5][0]++;cov_bo24uldxi().s[25]++;try{const result=(cov_bo24uldxi().s[26]++,await jobModels.findOne({where:{location:{[Op.like]:`%${location}%`},availability:user.availability,user_id:null,isClaimed:'false'}}));// authModels.update({ other_appointment: result.name}, { where: { id: user.id } })
cov_bo24uldxi().s[27]++;for(let i=(cov_bo24uldxi().s[28]++,0);i<all.length;i++){cov_bo24uldxi().s[29]++;//to get limit time, agter 1hour data expire and can see by other
if((cov_bo24uldxi().b[7][0]++,thisHours>=8)&&(cov_bo24uldxi().b[7][1]++,thisHours-new Date(all[i].updatedAt).getHours()>0)&&(cov_bo24uldxi().b[7][2]++,all[i].user_id!==null)){cov_bo24uldxi().b[6][0]++;cov_bo24uldxi().s[30]++;// console.log(new Date(second-all[i].updatedAt).getSeconds());
await jobModels.update({user_id:null},{where:{user_id:all[i].user_id}}).catch(function(error){cov_bo24uldxi().f[1]++;cov_bo24uldxi().s[31]++;console.error(error);});}else{cov_bo24uldxi().b[6][1]++;}}cov_bo24uldxi().s[32]++;try{cov_bo24uldxi().s[33]++;await jobModels.update({user_id:user.id},{where:{id:result.id}});}catch(error){cov_bo24uldxi().s[34]++;console.log('no more job');}cov_bo24uldxi().s[35]++;result.user_id=user.id;cov_bo24uldxi().s[36]++;return helper.response(response,200,result);}catch(error){cov_bo24uldxi().s[37]++;// if data has reach end, then clear user_id on job for reset mark.
try{cov_bo24uldxi().s[38]++;await jobModels.update({user_id:null},{where:{user_id:user.id}});}catch(error){cov_bo24uldxi().s[39]++;console.log('no more jobs');}cov_bo24uldxi().s[40]++;return helper.response(response,200,{message:'no more jobs'});}}else{cov_bo24uldxi().b[5][1]++;cov_bo24uldxi().s[41]++;return helper.response(response,404,{message:'you have another appointment'});}}catch(error){cov_bo24uldxi().s[42]++;console.log(error);cov_bo24uldxi().s[43]++;return helper.response(response,500,error);}},putJob:async function(request,response){cov_bo24uldxi().f[2]++;cov_bo24uldxi().s[44]++;try{const user=(cov_bo24uldxi().s[45]++,await authModels.findOne({where:{username:request.token.result.username}}));// if(user.other_appointment==="none"){
let isClaimed=(cov_bo24uldxi().s[46]++,request.body.isClaimed);const job_id=(cov_bo24uldxi().s[47]++,request.params.id);const data=(cov_bo24uldxi().s[48]++,await jobModels.findOne({where:{id:job_id}}));cov_bo24uldxi().s[49]++;console.log(user.other_appointment);cov_bo24uldxi().s[50]++;if(request.token.result.id!==data.user_id){cov_bo24uldxi().b[8][0]++;cov_bo24uldxi().s[51]++;return helper.response(response,401,{message:"dont have access"});}else{cov_bo24uldxi().b[8][1]++;}cov_bo24uldxi().s[52]++;jobModels.update({user_id:null,isClaimed:isClaimed},{where:{id:job_id}});cov_bo24uldxi().s[53]++;if(isClaimed==="true"){cov_bo24uldxi().b[9][0]++;cov_bo24uldxi().s[54]++;authModels.update({other_appointment:data.name},{where:{id:user.id}});cov_bo24uldxi().s[55]++;jobModels.update({isClaimed:isClaimed},{where:{id:job_id}});}else{cov_bo24uldxi().b[9][1]++;cov_bo24uldxi().s[56]++;jobModels.update({isClaimed:isClaimed},{where:{id:job_id}});}// result.user_id=user.id;
cov_bo24uldxi().s[57]++;data.user_id=null;cov_bo24uldxi().s[58]++;return helper.response(response,200,data);}catch(error){cov_bo24uldxi().s[59]++;console.log(error);cov_bo24uldxi().s[60]++;return helper.response(response,500,error);}},postJob:async function(request,response){cov_bo24uldxi().f[3]++;cov_bo24uldxi().s[61]++;try{const addData=(cov_bo24uldxi().s[62]++,request.body);const result=(cov_bo24uldxi().s[63]++,await jobModels.create(addData));cov_bo24uldxi().s[64]++;return helper.response(response,200,result);}catch(error){cov_bo24uldxi().s[65]++;// console.log(error)
return helper.response(response,500,error);}}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpvYi5qcyJdLCJuYW1lcyI6WyJqb2JNb2RlbHMiLCJyZXF1aXJlIiwiYXV0aE1vZGVscyIsIk9wIiwiaGVscGVyIiwiZSIsImNvbmZpZyIsInJlZnJlc2hUb2tlbnMiLCJtb2R1bGUiLCJleHBvcnRzIiwiZ2V0Sm9icyIsInJlcXVlc3QiLCJyZXNwb25zZSIsImxvY2F0aW9uIiwiZGF0ZV9vYiIsIkRhdGUiLCJ0aGlzSG91cnMiLCJnZXRIb3VycyIsIm1lc3NhZ2UiLCJ1c2VyIiwiZmluZE9uZSIsIndoZXJlIiwidXNlcm5hbWUiLCJ0b2tlbiIsInJlc3VsdCIsInF1ZXJ5IiwidW5kZWZpbmVkIiwiYWxsIiwiZmluZEFsbCIsImxpa2UiLCJhdmFpbGFiaWxpdHkiLCJ1c2VyX2lkIiwibmUiLCJpc0NsYWltZWQiLCJjaGVjayIsImlkIiwibGVuZ3RoIiwidXBkYXRlIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwib3RoZXJfYXBwb2ludG1lbnQiLCJpIiwidXBkYXRlZEF0IiwiY2F0Y2giLCJwdXRKb2IiLCJib2R5Iiwiam9iX2lkIiwicGFyYW1zIiwiZGF0YSIsIm5hbWUiLCJwb3N0Sm9iIiwiYWRkRGF0YSIsImNyZWF0ZSJdLCJtYXBwaW5ncyI6ImdpUEFlWTt5RkFmWixLQUFNQSxDQUFBQSxTQUFTLHlCQUFHQyxPQUFPLENBQUMsb0JBQUQsQ0FBVixDQUFmLENBQ0EsS0FBTUMsQ0FBQUEsVUFBVSx5QkFBR0QsT0FBTyxDQUFDLHFCQUFELENBQVYsQ0FBaEIsQ0FDQSxLQUFNLENBQUVFLEVBQUYsMEJBQVNGLE9BQU8sQ0FBQyxXQUFELENBQWhCLENBQU4sQ0FDQSxLQUFNRyxDQUFBQSxNQUFNLHlCQUFHSCxPQUFPLENBQUMsWUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNSSxDQUFBQSxDQUFDLHlCQUFHSixPQUFPLENBQUMsU0FBRCxDQUFWLENBQVAsQ0FDQTt1QkFFQUEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkssTUFBbEIsR0FDQSxLQUFNQyxDQUFBQSxhQUFhLHlCQUFHLEVBQUgsQ0FBbkIsQyx1QkFDQUMsTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBRWJDLE9BQU8sQ0FBRSxlQUFnQkMsT0FBaEIsQ0FBeUJDLFFBQXpCLENBQW1DLCtDQUN4QyxHQUFJLENBQ0EsR0FBSUMsQ0FBQUEsUUFBUSx5QkFBRyxFQUFILENBQVosQ0FDQSxHQUFJQyxDQUFBQSxPQUFPLDBCQUFHLEdBQUlDLENBQUFBLElBQUosRUFBSCxDQUFYLENBQ0EsR0FBSUMsQ0FBQUEsU0FBUywwQkFBR0YsT0FBTyxDQUFDRyxRQUFSLEVBQUgsQ0FBYixDQUNBO0FBSkEsd0JBS0EsR0FBSUQsU0FBUyxDQUFHLENBQWhCLENBQW1CLG1EQUNmLE1BQU9aLENBQUFBLE1BQU0sQ0FBQ1EsUUFBUCxDQUFnQkEsUUFBaEIsQ0FBMEIsR0FBMUIsQ0FBK0IsQ0FBRU0sT0FBTyxDQUFFLHlDQUFYLENBQS9CLENBQVAsQ0FDSCxDQUZELGdDQUdBLEtBQU1DLENBQUFBLElBQUksMEJBQUcsS0FBTWpCLENBQUFBLFVBQVUsQ0FBQ2tCLE9BQVgsQ0FBbUIsQ0FBRUMsS0FBSyxDQUFFLENBQUVDLFFBQVEsQ0FBRVgsT0FBTyxDQUFDWSxLQUFSLENBQWNDLE1BQWQsQ0FBcUJGLFFBQWpDLENBQVQsQ0FBbkIsQ0FBVCxDQUFWLENBUkEsd0JBU0EsR0FBSSwyQkFBQVgsT0FBTyxDQUFDYyxLQUFSLENBQWNaLFFBQWQsR0FBMkIsSUFBM0IsOEJBQW1DRixPQUFPLENBQUNjLEtBQVIsQ0FBY1osUUFBZCxHQUEyQmEsU0FBOUQsOEJBQTJFZixPQUFPLENBQUNjLEtBQVIsQ0FBY1osUUFBZCxHQUEyQixFQUF0RyxDQUFKLENBQThHLG1EQUMxR0EsUUFBUSxDQUFHTSxJQUFJLENBQUNOLFFBQWhCLENBQ0gsQ0FGRCxJQUdLLG1EQUNEQSxRQUFRLENBQUdGLE9BQU8sQ0FBQ2MsS0FBUixDQUFjWixRQUF6QixDQUNILENBQ0Q7QUFFQTtBQUNBO0FBRUEsS0FBTWMsQ0FBQUEsR0FBRywwQkFBRyxLQUFNM0IsQ0FBQUEsU0FBUyxDQUFDNEIsT0FBVixDQUFrQixDQUNoQ1AsS0FBSyxDQUFFLENBQ0hSLFFBQVEsQ0FBRSxDQUFFLENBQUNWLEVBQUUsQ0FBQzBCLElBQUosRUFBWSxJQUFHaEIsUUFBUyxHQUExQixDQURQLENBQ3VDaUIsWUFBWSxDQUFFWCxJQUFJLENBQUNXLFlBRDFELENBQ3dFQyxPQUFPLENBQUUsQ0FDaEYsQ0FBQzVCLEVBQUUsQ0FBQzZCLEVBQUosRUFBUyxJQUR1RSxDQURqRixDQUdBQyxTQUFTLENBQUUsT0FIWCxDQUR5QixDQUFsQixDQUFULENBQVQsQ0FRQSxLQUFNQyxDQUFBQSxLQUFLLDBCQUFHLEtBQU1sQyxDQUFBQSxTQUFTLENBQUM0QixPQUFWLENBQWtCLENBQUVQLEtBQUssQ0FBRSxDQUFFUixRQUFRLENBQUUsQ0FBRSxDQUFDVixFQUFFLENBQUMwQixJQUFKLEVBQVksSUFBR2hCLFFBQVMsR0FBMUIsQ0FBWixDQUE0Q2lCLFlBQVksQ0FBRVgsSUFBSSxDQUFDVyxZQUEvRCxDQUE2RUMsT0FBTyxDQUFFWixJQUFJLENBQUNnQixFQUEzRixDQUErRkYsU0FBUyxDQUFFLE9BQTFHLENBQVQsQ0FBbEIsQ0FBVCxDQUFYLENBNUJBLHdCQTZCQSxHQUFJLDJCQUFBQyxLQUFLLDhCQUFJQSxLQUFLLENBQUNFLE1BQU4sQ0FBZSxDQUFuQixDQUFULENBQStCLG1EQUMzQixHQUFJLHlCQUNBLEtBQU1wQyxDQUFBQSxTQUFTLENBQUNxQyxNQUFWLENBQWlCLENBQUVOLE9BQU8sQ0FBRSxJQUFYLENBQWpCLENBQW9DLENBQUVWLEtBQUssQ0FBRSxDQUFFVSxPQUFPLENBQUVaLElBQUksQ0FBQ2dCLEVBQWhCLENBQVQsQ0FBcEMsQ0FBTixDQUVILENBQUMsTUFBT0csS0FBUCxDQUFjLHlCQUNaQyxPQUFPLENBQUNDLEdBQVIsQ0FBWSxnQkFBWixFQUNILENBQ0osQ0FQRCxnQ0E3QkEsd0JBcUNBLEdBQUlyQixJQUFJLENBQUNzQixpQkFBTCxHQUEyQixNQUEvQixDQUF1QyxtREFDbkMsR0FBSSxDQUNBLEtBQU1qQixDQUFBQSxNQUFNLDBCQUFHLEtBQU14QixDQUFBQSxTQUFTLENBQUNvQixPQUFWLENBQWtCLENBQUVDLEtBQUssQ0FBRSxDQUFFUixRQUFRLENBQUUsQ0FBRSxDQUFDVixFQUFFLENBQUMwQixJQUFKLEVBQVksSUFBR2hCLFFBQVMsR0FBMUIsQ0FBWixDQUE0Q2lCLFlBQVksQ0FBRVgsSUFBSSxDQUFDVyxZQUEvRCxDQUE2RUMsT0FBTyxDQUFFLElBQXRGLENBQTRGRSxTQUFTLENBQUUsT0FBdkcsQ0FBVCxDQUFsQixDQUFULENBQVosQ0FDQTtBQUZBLHdCQUlBLElBQUssR0FBSVMsQ0FBQUEsQ0FBQywwQkFBRyxDQUFILENBQVYsQ0FBZ0JBLENBQUMsQ0FBR2YsR0FBRyxDQUFDUyxNQUF4QixDQUFnQ00sQ0FBQyxFQUFqQyxDQUFxQyx5QkFDakM7QUFDQSxHQUFJLDJCQUFBMUIsU0FBUyxFQUFJLENBQWIsOEJBQWtCQSxTQUFTLENBQUcsR0FBSUQsQ0FBQUEsSUFBSixDQUFTWSxHQUFHLENBQUNlLENBQUQsQ0FBSCxDQUFPQyxTQUFoQixFQUEyQjFCLFFBQTNCLEVBQVosQ0FBb0QsQ0FBdEUsOEJBQTJFVSxHQUFHLENBQUNlLENBQUQsQ0FBSCxDQUFPWCxPQUFQLEdBQW1CLElBQTlGLENBQUosQ0FBd0csbURBQ3BHO0FBQ0EsS0FBTS9CLENBQUFBLFNBQVMsQ0FBQ3FDLE1BQVYsQ0FBaUIsQ0FBRU4sT0FBTyxDQUFFLElBQVgsQ0FBakIsQ0FBb0MsQ0FBRVYsS0FBSyxDQUFFLENBQUVVLE9BQU8sQ0FBRUosR0FBRyxDQUFDZSxDQUFELENBQUgsQ0FBT1gsT0FBbEIsQ0FBVCxDQUFwQyxFQUE0RWEsS0FBNUUsQ0FBa0YsU0FBVU4sS0FBVixDQUFpQixnREFDckdDLE9BQU8sQ0FBQ0QsS0FBUixDQUFjQSxLQUFkLEVBQ0gsQ0FGSyxDQUFOLENBR0gsQ0FMRCxnQ0FNSCxDQVpELHdCQWFBLEdBQUkseUJBQ0EsS0FBTXRDLENBQUFBLFNBQVMsQ0FBQ3FDLE1BQVYsQ0FBaUIsQ0FBRU4sT0FBTyxDQUFFWixJQUFJLENBQUNnQixFQUFoQixDQUFqQixDQUF1QyxDQUFFZCxLQUFLLENBQUUsQ0FBRWMsRUFBRSxDQUFFWCxNQUFNLENBQUNXLEVBQWIsQ0FBVCxDQUF2QyxDQUFOLENBRUgsQ0FBQyxNQUFPRyxLQUFQLENBQWMseUJBQ1pDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGFBQVosRUFDSCxDQWxCRCx3QkFtQkFoQixNQUFNLENBQUNPLE9BQVAsQ0FBaUJaLElBQUksQ0FBQ2dCLEVBQXRCLENBbkJBLHdCQW9CQSxNQUFPL0IsQ0FBQUEsTUFBTSxDQUFDUSxRQUFQLENBQWdCQSxRQUFoQixDQUEwQixHQUExQixDQUErQlksTUFBL0IsQ0FBUCxDQUNILENBQUMsTUFBT2MsS0FBUCxDQUFjLHlCQUNaO0FBQ0EsR0FBSSx5QkFDQSxLQUFNdEMsQ0FBQUEsU0FBUyxDQUFDcUMsTUFBVixDQUFpQixDQUFFTixPQUFPLENBQUUsSUFBWCxDQUFqQixDQUFvQyxDQUFFVixLQUFLLENBQUUsQ0FBRVUsT0FBTyxDQUFFWixJQUFJLENBQUNnQixFQUFoQixDQUFULENBQXBDLENBQU4sQ0FFSCxDQUFDLE1BQU9HLEtBQVAsQ0FBYyx5QkFDWkMsT0FBTyxDQUFDQyxHQUFSLENBQVksY0FBWixFQUNILENBUFcsd0JBU1osTUFBT3BDLENBQUFBLE1BQU0sQ0FBQ1EsUUFBUCxDQUFnQkEsUUFBaEIsQ0FBMEIsR0FBMUIsQ0FBK0IsQ0FBRU0sT0FBTyxDQUFFLGNBQVgsQ0FBL0IsQ0FBUCxDQUNILENBRUosQ0FsQ0QsSUFvQ0ssbURBQ0QsTUFBT2QsQ0FBQUEsTUFBTSxDQUFDUSxRQUFQLENBQWdCQSxRQUFoQixDQUEwQixHQUExQixDQUErQixDQUFFTSxPQUFPLENBQUUsOEJBQVgsQ0FBL0IsQ0FBUCxDQUVILENBRUosQ0FBQyxNQUFPb0IsS0FBUCxDQUFjLHlCQUNaQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUYsS0FBWixFQURZLHdCQUdaLE1BQU9sQyxDQUFBQSxNQUFNLENBQUNRLFFBQVAsQ0FBZ0JBLFFBQWhCLENBQTBCLEdBQTFCLENBQStCMEIsS0FBL0IsQ0FBUCxDQUVILENBRUosQ0F4RlksQ0F5RmJPLE1BQU0sQ0FBRSxlQUFnQmxDLE9BQWhCLENBQXlCQyxRQUF6QixDQUFtQyxnREFDdkMsR0FBSSxDQUNBLEtBQU1PLENBQUFBLElBQUksMEJBQUcsS0FBTWpCLENBQUFBLFVBQVUsQ0FBQ2tCLE9BQVgsQ0FBbUIsQ0FBRUMsS0FBSyxDQUFFLENBQUVDLFFBQVEsQ0FBRVgsT0FBTyxDQUFDWSxLQUFSLENBQWNDLE1BQWQsQ0FBcUJGLFFBQWpDLENBQVQsQ0FBbkIsQ0FBVCxDQUFWLENBQ0E7QUFDQSxHQUFJVyxDQUFBQSxTQUFTLDBCQUFHdEIsT0FBTyxDQUFDbUMsSUFBUixDQUFhYixTQUFoQixDQUFiLENBQ0EsS0FBTWMsQ0FBQUEsTUFBTSwwQkFBR3BDLE9BQU8sQ0FBQ3FDLE1BQVIsQ0FBZWIsRUFBbEIsQ0FBWixDQUNBLEtBQU1jLENBQUFBLElBQUksMEJBQUcsS0FBTWpELENBQUFBLFNBQVMsQ0FBQ29CLE9BQVYsQ0FBa0IsQ0FBRUMsS0FBSyxDQUFFLENBQUVjLEVBQUUsQ0FBRVksTUFBTixDQUFULENBQWxCLENBQVQsQ0FBVixDQUxBLHdCQU1BUixPQUFPLENBQUNDLEdBQVIsQ0FBWXJCLElBQUksQ0FBQ3NCLGlCQUFqQixFQU5BLHdCQVFBLEdBQUk5QixPQUFPLENBQUNZLEtBQVIsQ0FBY0MsTUFBZCxDQUFxQlcsRUFBckIsR0FBNEJjLElBQUksQ0FBQ2xCLE9BQXJDLENBQThDLG1EQUMxQyxNQUFPM0IsQ0FBQUEsTUFBTSxDQUFDUSxRQUFQLENBQWdCQSxRQUFoQixDQUEwQixHQUExQixDQUErQixDQUFFTSxPQUFPLENBQUUsa0JBQVgsQ0FBL0IsQ0FBUCxDQUVILENBSEQsZ0NBUkEsd0JBWUFsQixTQUFTLENBQUNxQyxNQUFWLENBQWlCLENBQUVOLE9BQU8sQ0FBRSxJQUFYLENBQWlCRSxTQUFTLENBQUVBLFNBQTVCLENBQWpCLENBQTBELENBQUVaLEtBQUssQ0FBRSxDQUFFYyxFQUFFLENBQUVZLE1BQU4sQ0FBVCxDQUExRCxFQVpBLHdCQWFBLEdBQUlkLFNBQVMsR0FBSyxNQUFsQixDQUEwQixtREFDdEIvQixVQUFVLENBQUNtQyxNQUFYLENBQWtCLENBQUVJLGlCQUFpQixDQUFFUSxJQUFJLENBQUNDLElBQTFCLENBQWxCLENBQW9ELENBQUU3QixLQUFLLENBQUUsQ0FBRWMsRUFBRSxDQUFFaEIsSUFBSSxDQUFDZ0IsRUFBWCxDQUFULENBQXBELEVBRHNCLHdCQUd0Qm5DLFNBQVMsQ0FBQ3FDLE1BQVYsQ0FBaUIsQ0FBRUosU0FBUyxDQUFFQSxTQUFiLENBQWpCLENBQTJDLENBQUVaLEtBQUssQ0FBRSxDQUFFYyxFQUFFLENBQUVZLE1BQU4sQ0FBVCxDQUEzQyxFQUNILENBSkQsSUFNSyxtREFDRC9DLFNBQVMsQ0FBQ3FDLE1BQVYsQ0FBaUIsQ0FBRUosU0FBUyxDQUFFQSxTQUFiLENBQWpCLENBQTJDLENBQUVaLEtBQUssQ0FBRSxDQUFFYyxFQUFFLENBQUVZLE1BQU4sQ0FBVCxDQUEzQyxFQUVILENBQ0Q7QUF2QkEsd0JBd0JBRSxJQUFJLENBQUNsQixPQUFMLENBQWUsSUFBZixDQXhCQSx3QkEwQkEsTUFBTzNCLENBQUFBLE1BQU0sQ0FBQ1EsUUFBUCxDQUFnQkEsUUFBaEIsQ0FBMEIsR0FBMUIsQ0FBK0JxQyxJQUEvQixDQUFQLENBRUgsQ0FBQyxNQUFPWCxLQUFQLENBQWMseUJBQ1pDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaLEVBRFksd0JBR1osTUFBT2xDLENBQUFBLE1BQU0sQ0FBQ1EsUUFBUCxDQUFnQkEsUUFBaEIsQ0FBMEIsR0FBMUIsQ0FBK0IwQixLQUEvQixDQUFQLENBRUgsQ0FFSixDQTdIWSxDQThIYmEsT0FBTyxDQUFFLGVBQWdCeEMsT0FBaEIsQ0FBeUJDLFFBQXpCLENBQW1DLGdEQUN4QyxHQUFJLENBQ0EsS0FBTXdDLENBQUFBLE9BQU8sMEJBQUd6QyxPQUFPLENBQUNtQyxJQUFYLENBQWIsQ0FFQSxLQUFNdEIsQ0FBQUEsTUFBTSwwQkFBRyxLQUFNeEIsQ0FBQUEsU0FBUyxDQUFDcUQsTUFBVixDQUFpQkQsT0FBakIsQ0FBVCxDQUFaLENBSEEsd0JBSUEsTUFBT2hELENBQUFBLE1BQU0sQ0FBQ1EsUUFBUCxDQUFnQkEsUUFBaEIsQ0FBMEIsR0FBMUIsQ0FBK0JZLE1BQS9CLENBQVAsQ0FFSCxDQUFDLE1BQU9jLEtBQVAsQ0FBYyx5QkFDWjtBQUNBLE1BQU9sQyxDQUFBQSxNQUFNLENBQUNRLFFBQVAsQ0FBZ0JBLFFBQWhCLENBQTBCLEdBQTFCLENBQStCMEIsS0FBL0IsQ0FBUCxDQUVILENBRUosQ0EzSVksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBqb2JNb2RlbHMgPSByZXF1aXJlKCcuLi9tb2RlbHMvam9iTW9kZWwnKVxuY29uc3QgYXV0aE1vZGVscyA9IHJlcXVpcmUoJy4uL21vZGVscy9hdXRoTW9kZWwnKVxuY29uc3QgeyBPcCB9ID0gcmVxdWlyZShcInNlcXVlbGl6ZVwiKTtcbmNvbnN0IGhlbHBlciA9IHJlcXVpcmUoJy4uL2hlbHBlcnMnKVxuY29uc3QgZSA9IHJlcXVpcmUoJ2V4cHJlc3MnKVxuLy8gY29uc3QgeyBkZWxldGUgfSA9IHJlcXVpcmUoJy4uLy4uL2FwcCcpXG5cbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpXG5jb25zdCByZWZyZXNoVG9rZW5zID0gW11cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgZ2V0Sm9iczogYXN5bmMgZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgbG9jYXRpb24gPSAnJztcbiAgICAgICAgICAgIGxldCBkYXRlX29iID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGxldCB0aGlzSG91cnMgPSBkYXRlX29iLmdldEhvdXJzKCk7XG4gICAgICAgICAgICAvL29wZW4gYXQgOCBhbVxuICAgICAgICAgICAgaWYgKHRoaXNIb3VycyA8IDgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA0MDEsIHsgbWVzc2FnZTogJ2pvYnMgc3RpbGwgY2xvc2VkLCBhbmQgd2lsbCBPcGVuIGF0IDhhbScgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBhdXRoTW9kZWxzLmZpbmRPbmUoeyB3aGVyZTogeyB1c2VybmFtZTogcmVxdWVzdC50b2tlbi5yZXN1bHQudXNlcm5hbWUgfSB9KTtcbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnF1ZXJ5LmxvY2F0aW9uID09PSBudWxsIHx8IHJlcXVlc3QucXVlcnkubG9jYXRpb24gPT09IHVuZGVmaW5lZCB8fCByZXF1ZXN0LnF1ZXJ5LmxvY2F0aW9uID09PSAnJykge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gdXNlci5sb2NhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gcmVxdWVzdC5xdWVyeS5sb2NhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGN1cnJlbnQgaG91cnNcblxuICAgICAgICAgICAgLy8gbGV0IG1pbnV0ZXMgPSBkYXRlX29iLmdldE1pbnV0ZXMoKTtcbiAgICAgICAgICAgIC8vIGxldCBzZWNvbmQgPSBkYXRlX29iLmdldFNlY29uZHMoKTtcblxuICAgICAgICAgICAgY29uc3QgYWxsID0gYXdhaXQgam9iTW9kZWxzLmZpbmRBbGwoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB7IFtPcC5saWtlXTogYCUke2xvY2F0aW9ufSVgIH0sIGF2YWlsYWJpbGl0eTogdXNlci5hdmFpbGFiaWxpdHksIHVzZXJfaWQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFtPcC5uZV06IG51bGxcbiAgICAgICAgICAgICAgICAgICAgfSwgaXNDbGFpbWVkOiAnZmFsc2UnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgY29uc3QgY2hlY2sgPSBhd2FpdCBqb2JNb2RlbHMuZmluZEFsbCh7IHdoZXJlOiB7IGxvY2F0aW9uOiB7IFtPcC5saWtlXTogYCUke2xvY2F0aW9ufSVgIH0sIGF2YWlsYWJpbGl0eTogdXNlci5hdmFpbGFiaWxpdHksIHVzZXJfaWQ6IHVzZXIuaWQsIGlzQ2xhaW1lZDogJ2ZhbHNlJyB9IH0pXG4gICAgICAgICAgICBpZiAoY2hlY2sgJiYgY2hlY2subGVuZ3RoID4gNSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGpvYk1vZGVscy51cGRhdGUoeyB1c2VyX2lkOiBudWxsIH0sIHsgd2hlcmU6IHsgdXNlcl9pZDogdXNlci5pZCB9IH0pO1xuXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIG1vcmUgam9ic3NzJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodXNlci5vdGhlcl9hcHBvaW50bWVudCA9PT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBqb2JNb2RlbHMuZmluZE9uZSh7IHdoZXJlOiB7IGxvY2F0aW9uOiB7IFtPcC5saWtlXTogYCUke2xvY2F0aW9ufSVgIH0sIGF2YWlsYWJpbGl0eTogdXNlci5hdmFpbGFiaWxpdHksIHVzZXJfaWQ6IG51bGwsIGlzQ2xhaW1lZDogJ2ZhbHNlJyB9IH0pO1xuICAgICAgICAgICAgICAgICAgICAvLyBhdXRoTW9kZWxzLnVwZGF0ZSh7IG90aGVyX2FwcG9pbnRtZW50OiByZXN1bHQubmFtZX0sIHsgd2hlcmU6IHsgaWQ6IHVzZXIuaWQgfSB9KVxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWxsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL3RvIGdldCBsaW1pdCB0aW1lLCBhZ3RlciAxaG91ciBkYXRhIGV4cGlyZSBhbmQgY2FuIHNlZSBieSBvdGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNIb3VycyA+PSA4ICYmIHRoaXNIb3VycyAtIG5ldyBEYXRlKGFsbFtpXS51cGRhdGVkQXQpLmdldEhvdXJzKCkgPiAwICYmIGFsbFtpXS51c2VyX2lkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobmV3IERhdGUoc2Vjb25kLWFsbFtpXS51cGRhdGVkQXQpLmdldFNlY29uZHMoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgam9iTW9kZWxzLnVwZGF0ZSh7IHVzZXJfaWQ6IG51bGwgfSwgeyB3aGVyZTogeyB1c2VyX2lkOiBhbGxbaV0udXNlcl9pZCB9IH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGpvYk1vZGVscy51cGRhdGUoeyB1c2VyX2lkOiB1c2VyLmlkIH0sIHsgd2hlcmU6IHsgaWQ6IHJlc3VsdC5pZCB9IH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbm8gbW9yZSBqb2InKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC51c2VyX2lkID0gdXNlci5pZDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCByZXN1bHQpXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgZGF0YSBoYXMgcmVhY2ggZW5kLCB0aGVuIGNsZWFyIHVzZXJfaWQgb24gam9iIGZvciByZXNldCBtYXJrLlxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgam9iTW9kZWxzLnVwZGF0ZSh7IHVzZXJfaWQ6IG51bGwgfSwgeyB3aGVyZTogeyB1c2VyX2lkOiB1c2VyLmlkIH0gfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdubyBtb3JlIGpvYnMnKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCB7IG1lc3NhZ2U6ICdubyBtb3JlIGpvYnMnIH0pXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwNCwgeyBtZXNzYWdlOiAneW91IGhhdmUgYW5vdGhlciBhcHBvaW50bWVudCcgfSlcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuICAgIHB1dEpvYjogYXN5bmMgZnVuY3Rpb24gKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgYXV0aE1vZGVscy5maW5kT25lKHsgd2hlcmU6IHsgdXNlcm5hbWU6IHJlcXVlc3QudG9rZW4ucmVzdWx0LnVzZXJuYW1lIH0gfSk7XG4gICAgICAgICAgICAvLyBpZih1c2VyLm90aGVyX2FwcG9pbnRtZW50PT09XCJub25lXCIpe1xuICAgICAgICAgICAgbGV0IGlzQ2xhaW1lZCA9IHJlcXVlc3QuYm9keS5pc0NsYWltZWQ7XG4gICAgICAgICAgICBjb25zdCBqb2JfaWQgPSByZXF1ZXN0LnBhcmFtcy5pZDtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBqb2JNb2RlbHMuZmluZE9uZSh7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIub3RoZXJfYXBwb2ludG1lbnQpXG5cbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LnRva2VuLnJlc3VsdC5pZCAhPT0gZGF0YS51c2VyX2lkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNDAxLCB7IG1lc3NhZ2U6IFwiZG9udCBoYXZlIGFjY2Vzc1wiIH0pXG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGpvYk1vZGVscy51cGRhdGUoeyB1c2VyX2lkOiBudWxsLCBpc0NsYWltZWQ6IGlzQ2xhaW1lZCB9LCB7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KTtcbiAgICAgICAgICAgIGlmIChpc0NsYWltZWQgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgICAgICAgYXV0aE1vZGVscy51cGRhdGUoeyBvdGhlcl9hcHBvaW50bWVudDogZGF0YS5uYW1lIH0sIHsgd2hlcmU6IHsgaWQ6IHVzZXIuaWQgfSB9KVxuXG4gICAgICAgICAgICAgICAgam9iTW9kZWxzLnVwZGF0ZSh7IGlzQ2xhaW1lZDogaXNDbGFpbWVkIH0sIHsgd2hlcmU6IHsgaWQ6IGpvYl9pZCB9IH0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGpvYk1vZGVscy51cGRhdGUoeyBpc0NsYWltZWQ6IGlzQ2xhaW1lZCB9LCB7IHdoZXJlOiB7IGlkOiBqb2JfaWQgfSB9KVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyByZXN1bHQudXNlcl9pZD11c2VyLmlkO1xuICAgICAgICAgICAgZGF0YS51c2VyX2lkID0gbnVsbDtcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgMjAwLCBkYXRhKVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuICAgIHBvc3RKb2I6IGFzeW5jIGZ1bmN0aW9uIChyZXF1ZXN0LCByZXNwb25zZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYWRkRGF0YSA9IHJlcXVlc3QuYm9keVxuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBqb2JNb2RlbHMuY3JlYXRlKGFkZERhdGEpXG4gICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCAyMDAsIHJlc3VsdClcblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXJyb3IpXG4gICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA1MDAsIGVycm9yKVxuXG4gICAgICAgIH1cblxuICAgIH0sXG59XG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuIl19