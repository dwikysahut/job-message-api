function cov_16s1tle5jb(){var path="/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/auth.js";var hash="f7cd0681c9d29845a85f85e07c1fe5f2e5ec359f";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/dwikyhutomo/Arkademy/technical-test/jobBoard-api/src/controllers/auth.js",statementMap:{"0":{start:{line:1,column:19},end:{line:1,column:49}},"1":{start:{line:3,column:15},end:{line:3,column:36}},"2":{start:{line:4,column:12},end:{line:4,column:35}},"3":{start:{line:6,column:15},end:{line:6,column:32}},"4":{start:{line:7,column:0},end:{line:7,column:26}},"5":{start:{line:8,column:22},end:{line:8,column:24}},"6":{start:{line:9,column:0},end:{line:145,column:1}},"7":{start:{line:12,column:8},end:{line:22,column:9}},"8":{start:{line:13,column:27},end:{line:13,column:53}},"9":{start:{line:15,column:12},end:{line:15,column:57}},"10":{start:{line:18,column:12},end:{line:18,column:30}},"11":{start:{line:20,column:12},end:{line:20,column:56}},"12":{start:{line:26,column:8},end:{line:46,column:9}},"13":{start:{line:29,column:28},end:{line:29,column:40}},"14":{start:{line:30,column:31},end:{line:30,column:96}},"15":{start:{line:31,column:12},end:{line:31,column:31}},"16":{start:{line:32,column:12},end:{line:32,column:35}},"17":{start:{line:33,column:12},end:{line:40,column:13}},"18":{start:{line:35,column:16},end:{line:35,column:76}},"19":{start:{line:36,column:31},end:{line:36,column:63}},"20":{start:{line:37,column:16},end:{line:37,column:61}},"21":{start:{line:41,column:12},end:{line:41,column:82}},"22":{start:{line:43,column:12},end:{line:43,column:30}},"23":{start:{line:44,column:12},end:{line:44,column:56}},"24":{start:{line:50,column:8},end:{line:91,column:9}},"25":{start:{line:51,column:28},end:{line:51,column:40}},"26":{start:{line:52,column:12},end:{line:52,column:53}},"27":{start:{line:53,column:39},end:{line:53,column:71}},"28":{start:{line:55,column:12},end:{line:55,column:41}},"29":{start:{line:59,column:27},end:{line:59,column:91}},"30":{start:{line:63,column:12},end:{line:85,column:13}},"31":{start:{line:64,column:16},end:{line:64,column:91}},"32":{start:{line:67,column:17},end:{line:85,column:13}},"33":{start:{line:68,column:16},end:{line:68,column:91}},"34":{start:{line:74,column:30},end:{line:74,column:95}},"35":{start:{line:75,column:37},end:{line:75,column:97}},"36":{start:{line:76,column:32},end:{line:80,column:17}},"37":{start:{line:81,column:16},end:{line:81,column:39}},"38":{start:{line:82,column:16},end:{line:82,column:49}},"39":{start:{line:84,column:16},end:{line:84,column:55}},"40":{start:{line:88,column:12},end:{line:88,column:30}},"41":{start:{line:89,column:12},end:{line:89,column:56}},"42":{start:{line:98,column:8},end:{line:128,column:9}},"43":{start:{line:99,column:26},end:{line:99,column:44}},"44":{start:{line:100,column:12},end:{line:100,column:38}},"45":{start:{line:102,column:12},end:{line:104,column:13}},"46":{start:{line:103,column:16},end:{line:103,column:85}},"47":{start:{line:105,column:12},end:{line:107,column:13}},"48":{start:{line:106,column:16},end:{line:106,column:94}},"49":{start:{line:108,column:12},end:{line:121,column:14}},"50":{start:{line:110,column:16},end:{line:120,column:17}},"51":{start:{line:111,column:20},end:{line:111,column:82}},"52":{start:{line:114,column:34},end:{line:114,column:99}},"53":{start:{line:116,column:20},end:{line:116,column:68}},"54":{start:{line:125,column:12},end:{line:125,column:30}},"55":{start:{line:126,column:12},end:{line:126,column:56}},"56":{start:{line:133,column:8},end:{line:142,column:9}},"57":{start:{line:134,column:13},end:{line:134,column:65}},"58":{start:{line:134,column:42},end:{line:134,column:64}},"59":{start:{line:136,column:11},end:{line:136,column:47}},"60":{start:{line:139,column:12},end:{line:139,column:30}},"61":{start:{line:140,column:12},end:{line:140,column:56}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:13},end:{line:11,column:14}},loc:{start:{line:11,column:47},end:{line:24,column:5}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:25,column:18},end:{line:25,column:19}},loc:{start:{line:25,column:52},end:{line:48,column:5}},line:25},"2":{name:"(anonymous_2)",decl:{start:{line:49,column:15},end:{line:49,column:16}},loc:{start:{line:49,column:49},end:{line:93,column:5}},line:49},"3":{name:"(anonymous_3)",decl:{start:{line:95,column:14},end:{line:95,column:15}},loc:{start:{line:95,column:48},end:{line:130,column:5}},line:95},"4":{name:"(anonymous_4)",decl:{start:{line:108,column:64},end:{line:108,column:65}},loc:{start:{line:108,column:88},end:{line:121,column:13}},line:108},"5":{name:"(anonymous_5)",decl:{start:{line:132,column:17},end:{line:132,column:18}},loc:{start:{line:132,column:51},end:{line:144,column:5}},line:132},"6":{name:"(anonymous_6)",decl:{start:{line:134,column:34},end:{line:134,column:35}},loc:{start:{line:134,column:42},end:{line:134,column:64}},line:134}},branchMap:{"0":{loc:{start:{line:33,column:12},end:{line:40,column:13}},type:"if",locations:[{start:{line:33,column:12},end:{line:40,column:13}},{start:{line:33,column:12},end:{line:40,column:13}}],line:33},"1":{loc:{start:{line:33,column:16},end:{line:33,column:59}},type:"binary-expr",locations:[{start:{line:33,column:16},end:{line:33,column:40}},{start:{line:33,column:42},end:{line:33,column:59}}],line:33},"2":{loc:{start:{line:63,column:12},end:{line:85,column:13}},type:"if",locations:[{start:{line:63,column:12},end:{line:85,column:13}},{start:{line:63,column:12},end:{line:85,column:13}}],line:63},"3":{loc:{start:{line:63,column:16},end:{line:63,column:51}},type:"binary-expr",locations:[{start:{line:63,column:16},end:{line:63,column:36}},{start:{line:63,column:38},end:{line:63,column:51}}],line:63},"4":{loc:{start:{line:67,column:17},end:{line:85,column:13}},type:"if",locations:[{start:{line:67,column:17},end:{line:85,column:13}},{start:{line:67,column:17},end:{line:85,column:13}}],line:67},"5":{loc:{start:{line:102,column:12},end:{line:104,column:13}},type:"if",locations:[{start:{line:102,column:12},end:{line:104,column:13}},{start:{line:102,column:12},end:{line:104,column:13}}],line:102},"6":{loc:{start:{line:105,column:12},end:{line:107,column:13}},type:"if",locations:[{start:{line:105,column:12},end:{line:107,column:13}},{start:{line:105,column:12},end:{line:107,column:13}}],line:105},"7":{loc:{start:{line:110,column:16},end:{line:120,column:17}},type:"if",locations:[{start:{line:110,column:16},end:{line:120,column:17}},{start:{line:110,column:16},end:{line:120,column:17}}],line:110},"8":{loc:{start:{line:110,column:20},end:{line:110,column:110}},type:"binary-expr",locations:[{start:{line:110,column:20},end:{line:110,column:25}},{start:{line:110,column:29},end:{line:110,column:63}},{start:{line:110,column:67},end:{line:110,column:72}},{start:{line:110,column:76},end:{line:110,column:110}}],line:110}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"f7cd0681c9d29845a85f85e07c1fe5f2e5ec359f"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_16s1tle5jb=function(){return actualCoverage;};}return actualCoverage;}cov_16s1tle5jb();const authModels=(cov_16s1tle5jb().s[0]++,require('../models/authModel'));const helper=(cov_16s1tle5jb().s[1]++,require('../helpers'));const jwt=(cov_16s1tle5jb().s[2]++,require('jsonwebtoken'));// const md5 = require('md5');
const bcrypt=(cov_16s1tle5jb().s[3]++,require("bcrypt"));cov_16s1tle5jb().s[4]++;require('dotenv').config();const refreshTokens=(cov_16s1tle5jb().s[5]++,[]);cov_16s1tle5jb().s[6]++;module.exports={getUser:async function(request,response){cov_16s1tle5jb().f[0]++;cov_16s1tle5jb().s[7]++;try{const result=(cov_16s1tle5jb().s[8]++,await authModels.findAll());cov_16s1tle5jb().s[9]++;return helper.response(response,200,result);}catch(error){cov_16s1tle5jb().s[10]++;console.log(error);cov_16s1tle5jb().s[11]++;return helper.response(response,500,error);}},postRegister:async function(request,response){cov_16s1tle5jb().f[1]++;cov_16s1tle5jb().s[12]++;try{const setData=(cov_16s1tle5jb().s[13]++,request.body);const emailExist=(cov_16s1tle5jb().s[14]++,await authModels.findOne({where:{username:setData.username}}));cov_16s1tle5jb().s[15]++;console.log('ssss');cov_16s1tle5jb().s[16]++;console.log(emailExist);cov_16s1tle5jb().s[17]++;if((cov_16s1tle5jb().b[1][0]++,emailExist===undefined)||(cov_16s1tle5jb().b[1][1]++,emailExist===null)){cov_16s1tle5jb().b[0][0]++;cov_16s1tle5jb().s[18]++;setData.password=bcrypt.hashSync(request.body.password,10);const result=(cov_16s1tle5jb().s[19]++,await authModels.create(setData));cov_16s1tle5jb().s[20]++;return helper.response(response,200,result);}else{cov_16s1tle5jb().b[0][1]++;}cov_16s1tle5jb().s[21]++;return helper.response(response,400,{meessage:"email has taken"});}catch(error){cov_16s1tle5jb().s[22]++;console.log(error);cov_16s1tle5jb().s[23]++;return helper.response(response,500,error);}},postLogin:async function(request,response){cov_16s1tle5jb().f[2]++;cov_16s1tle5jb().s[24]++;try{const getData=(cov_16s1tle5jb().s[25]++,request.body);cov_16s1tle5jb().s[26]++;getData.password=request.body.password;const refreshTokenSecret=(cov_16s1tle5jb().s[27]++,process.env.REFRESH_TOKEN_SECRET);//  const refreshTokens = [];
cov_16s1tle5jb().s[28]++;console.log(getData.username);// console.log(getData.password)
const result=(cov_16s1tle5jb().s[29]++,await authModels.findOne({where:{username:getData.username}}));// console.log(result)
// const compare = bcrypt.compareSync(getData.password, result.password);
cov_16s1tle5jb().s[30]++;if((cov_16s1tle5jb().b[3][0]++,result===undefined)||(cov_16s1tle5jb().b[3][1]++,result===null)){cov_16s1tle5jb().b[2][0]++;cov_16s1tle5jb().s[31]++;return helper.response(response,401,{message:"username is incorrect"});}else{cov_16s1tle5jb().b[2][1]++;cov_16s1tle5jb().s[32]++;if(!bcrypt.compareSync(getData.password,result.password)){cov_16s1tle5jb().b[4][0]++;cov_16s1tle5jb().s[33]++;return helper.response(response,401,{message:"password is incorrect"});}else{cov_16s1tle5jb().b[4][1]++;//token structure: header,payload,verify signature
const token=(cov_16s1tle5jb().s[34]++,jwt.sign({result},process.env.SECRET_KEY,{expiresIn:'1d'}));const refreshToken=(cov_16s1tle5jb().s[35]++,jwt.sign({result},refreshTokenSecret,{expiresIn:'20h'}));const newData=(cov_16s1tle5jb().s[36]++,{result,token,refreshToken});cov_16s1tle5jb().s[37]++;delete newData.password;cov_16s1tle5jb().s[38]++;refreshTokens.push(refreshToken);cov_16s1tle5jb().s[39]++;helper.response(response,200,newData);}}}catch(error){cov_16s1tle5jb().s[40]++;console.log(error);cov_16s1tle5jb().s[41]++;return helper.response(response,500,error);}},getToken:async function(request,response){cov_16s1tle5jb().f[3]++;cov_16s1tle5jb().s[42]++;try{const token=(cov_16s1tle5jb().s[43]++,request.body.token);cov_16s1tle5jb().s[44]++;console.log(refreshTokens);cov_16s1tle5jb().s[45]++;if(!token){cov_16s1tle5jb().b[5][0]++;cov_16s1tle5jb().s[46]++;return helper.response(response,401,{message:"Unauthorization"});}else{cov_16s1tle5jb().b[5][1]++;}cov_16s1tle5jb().s[47]++;if(!refreshTokens.includes(token)){cov_16s1tle5jb().b[6][0]++;cov_16s1tle5jb().s[48]++;return helper.response(response,403,{message:"Token Null, Please Login"});}else{cov_16s1tle5jb().b[6][1]++;}cov_16s1tle5jb().s[49]++;jwt.verify(token,process.env.REFRESH_TOKEN_SECRET,function(error,result){cov_16s1tle5jb().f[4]++;cov_16s1tle5jb().s[50]++;if((cov_16s1tle5jb().b[8][0]++,error)&&(cov_16s1tle5jb().b[8][1]++,error.name==="TokenExpiredError")||(cov_16s1tle5jb().b[8][2]++,error)&&(cov_16s1tle5jb().b[8][3]++,error.name==="JsonWebTokenError")){cov_16s1tle5jb().b[7][0]++;cov_16s1tle5jb().s[51]++;return helper.response(response,403,{message:error.name});}else{cov_16s1tle5jb().b[7][1]++;const token=(cov_16s1tle5jb().s[52]++,jwt.sign({result},process.env.SECRET_KEY,{expiresIn:'2d'}));cov_16s1tle5jb().s[53]++;return helper.response(response,200,{token});}});}catch(error){cov_16s1tle5jb().s[54]++;console.log(error);cov_16s1tle5jb().s[55]++;return helper.response(response,500,error);}},deleteToken:async function(request,response){cov_16s1tle5jb().f[5]++;cov_16s1tle5jb().s[56]++;try{cov_16s1tle5jb().s[57]++;refreshTokens.filter(token=>{cov_16s1tle5jb().f[6]++;cov_16s1tle5jb().s[58]++;return token!==request.body;});cov_16s1tle5jb().s[59]++;response.send("logout Successfully");}catch(error){cov_16s1tle5jb().s[60]++;console.log(error);cov_16s1tle5jb().s[61]++;return helper.response(response,500,error);}}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiYXV0aE1vZGVscyIsInJlcXVpcmUiLCJoZWxwZXIiLCJqd3QiLCJiY3J5cHQiLCJjb25maWciLCJyZWZyZXNoVG9rZW5zIiwibW9kdWxlIiwiZXhwb3J0cyIsImdldFVzZXIiLCJyZXF1ZXN0IiwicmVzcG9uc2UiLCJyZXN1bHQiLCJmaW5kQWxsIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwicG9zdFJlZ2lzdGVyIiwic2V0RGF0YSIsImJvZHkiLCJlbWFpbEV4aXN0IiwiZmluZE9uZSIsIndoZXJlIiwidXNlcm5hbWUiLCJ1bmRlZmluZWQiLCJwYXNzd29yZCIsImhhc2hTeW5jIiwiY3JlYXRlIiwibWVlc3NhZ2UiLCJwb3N0TG9naW4iLCJnZXREYXRhIiwicmVmcmVzaFRva2VuU2VjcmV0IiwicHJvY2VzcyIsImVudiIsIlJFRlJFU0hfVE9LRU5fU0VDUkVUIiwibWVzc2FnZSIsImNvbXBhcmVTeW5jIiwidG9rZW4iLCJzaWduIiwiU0VDUkVUX0tFWSIsImV4cGlyZXNJbiIsInJlZnJlc2hUb2tlbiIsIm5ld0RhdGEiLCJwdXNoIiwiZ2V0VG9rZW4iLCJpbmNsdWRlcyIsInZlcmlmeSIsIm5hbWUiLCJkZWxldGVUb2tlbiIsImZpbHRlciIsInNlbmQiXSwibWFwcGluZ3MiOiJ3aVBBZVk7MkZBZlosS0FBTUEsQ0FBQUEsVUFBVSwwQkFBR0MsT0FBTyxDQUFDLHFCQUFELENBQVYsQ0FBaEIsQ0FFQSxLQUFNQyxDQUFBQSxNQUFNLDBCQUFHRCxPQUFPLENBQUMsWUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxHQUFHLDBCQUFHRixPQUFPLENBQUMsY0FBRCxDQUFWLENBQVQsQ0FDQTtBQUNBLEtBQU1HLENBQUFBLE1BQU0sMEJBQUdILE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBWixDLHdCQUNBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCSSxNQUFsQixHQUNBLEtBQU1DLENBQUFBLGFBQWEsMEJBQUcsRUFB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b250ZW50IjpbImNvbnN0IGF1dGhNb2RlbHMgPSByZXF1aXJlKCcuLi9tb2RlbHMvYXV0aE1vZGVsJylcblxuY29uc3QgaGVscGVyID0gcmVxdWlyZSgnLi4vaGVscGVycycpXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKVxuLy8gY29uc3QgbWQ1ID0gcmVxdWlyZSgnbWQ1Jyk7XG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0XCIpO1xucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKClcbmNvbnN0IHJlZnJlc2hUb2tlbnMgPSBbXVxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICBnZXRVc2VyOiBhc3luYyBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aE1vZGVscy5maW5kQWxsKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDIwMCwgcmVzdWx0KVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcblxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuICAgIHBvc3RSZWdpc3RlcjogYXN5bmMgZnVuY3Rpb24ocmVxdWVzdCwgcmVzcG9uc2UpIHtcbiAgICAgICAgdHJ5IHtcblxuXG4gICAgICAgICAgICBjb25zdCBzZXREYXRhID0gcmVxdWVzdC5ib2R5XG4gICAgICAgICAgICBjb25zdCBlbWFpbEV4aXN0ID0gYXdhaXQgYXV0aE1vZGVscy5maW5kT25lKHsgd2hlcmU6IHt1c2VybmFtZTogc2V0RGF0YS51c2VybmFtZX0gfSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzc3NzJylcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVtYWlsRXhpc3QpXG4gICAgICAgICAgICBpZiAoZW1haWxFeGlzdCA9PT0gdW5kZWZpbmVkfHxlbWFpbEV4aXN0PT09bnVsbCkge1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBzZXREYXRhLnBhc3N3b3JkID0gYmNyeXB0Lmhhc2hTeW5jKHJlcXVlc3QuYm9keS5wYXNzd29yZCwxMClcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoTW9kZWxzLmNyZWF0ZShzZXREYXRhKVxuICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDIwMCwgcmVzdWx0KVxuXG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMCwgeyBtZWVzc2FnZTogXCJlbWFpbCBoYXMgdGFrZW5cIiB9KVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXG4gICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA1MDAsIGVycm9yKVxuXG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgcG9zdExvZ2luOiBhc3luYyBmdW5jdGlvbihyZXF1ZXN0LCByZXNwb25zZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZ2V0RGF0YSA9IHJlcXVlc3QuYm9keVxuICAgICAgICAgICAgZ2V0RGF0YS5wYXNzd29yZCA9IHJlcXVlc3QuYm9keS5wYXNzd29yZDtcbiAgICAgICAgICAgIGNvbnN0IHJlZnJlc2hUb2tlblNlY3JldCA9IHByb2Nlc3MuZW52LlJFRlJFU0hfVE9LRU5fU0VDUkVUO1xuICAgICAgICAgICAgLy8gIGNvbnN0IHJlZnJlc2hUb2tlbnMgPSBbXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGdldERhdGEudXNlcm5hbWUpXG5cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGdldERhdGEucGFzc3dvcmQpXG4gICAgICAgIFxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aE1vZGVscy5maW5kT25lKHsgd2hlcmU6IHt1c2VybmFtZTpnZXREYXRhLnVzZXJuYW1lfSB9KVxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVzdWx0KVxuICAgICAgICAgICAgLy8gY29uc3QgY29tcGFyZSA9IGJjcnlwdC5jb21wYXJlU3luYyhnZXREYXRhLnBhc3N3b3JkLCByZXN1bHQucGFzc3dvcmQpO1xuICAgIFxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdW5kZWZpbmVkfHxyZXN1bHQ9PT1udWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNDAxLCB7IG1lc3NhZ2U6IFwidXNlcm5hbWUgaXMgaW5jb3JyZWN0XCIgfSlcblxuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIGVsc2UgaWYgKCFiY3J5cHQuY29tcGFyZVN5bmMoZ2V0RGF0YS5wYXNzd29yZCwgcmVzdWx0LnBhc3N3b3JkKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMSwgeyBtZXNzYWdlOiBcInBhc3N3b3JkIGlzIGluY29ycmVjdFwiIH0pXG5cbiAgICAgICAgICAgIH0gXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vdG9rZW4gc3RydWN0dXJlOiBoZWFkZXIscGF5bG9hZCx2ZXJpZnkgc2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih7IHJlc3VsdCB9LCBwcm9jZXNzLmVudi5TRUNSRVRfS0VZLCB7IGV4cGlyZXNJbjogJzFkJyB9KVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IGp3dC5zaWduKHsgcmVzdWx0IH0sIHJlZnJlc2hUb2tlblNlY3JldCx7IGV4cGlyZXNJbjogJzIwaCd9KVxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWxldGUgbmV3RGF0YS5wYXNzd29yZFxuICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbnMucHVzaChyZWZyZXNoVG9rZW4pO1xuXG4gICAgICAgICAgICAgICAgaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCAyMDAsIG5ld0RhdGEpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuXG4gICAgZ2V0VG9rZW46IGFzeW5jIGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG5cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmJvZHkudG9rZW5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlZnJlc2hUb2tlbnMpXG5cbiAgICAgICAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCA0MDEsIHsgbWVzc2FnZTogXCJVbmF1dGhvcml6YXRpb25cIiB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFyZWZyZXNoVG9rZW5zLmluY2x1ZGVzKHRva2VuKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDQwMywgeyBtZXNzYWdlOiBcIlRva2VuIE51bGwsIFBsZWFzZSBMb2dpblwiIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5SRUZSRVNIX1RPS0VOX1NFQ1JFVCwgZnVuY3Rpb24oZXJyb3IsIHJlc3VsdCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yICYmIGVycm9yLm5hbWUgPT09IFwiVG9rZW5FeHBpcmVkRXJyb3JcIiB8fCBlcnJvciAmJiBlcnJvci5uYW1lID09PSBcIkpzb25XZWJUb2tlbkVycm9yXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNDAzLCB7IG1lc3NhZ2U6IGVycm9yLm5hbWUgfSlcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oeyByZXN1bHQgfSwgcHJvY2Vzcy5lbnYuU0VDUkVUX0tFWSwgeyBleHBpcmVzSW46ICcyZCcgfSlcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnJlc3BvbnNlKHJlc3BvbnNlLCAyMDAsIHsgdG9rZW4gfSlcblxuXG5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICAgICAgcmV0dXJuIGhlbHBlci5yZXNwb25zZShyZXNwb25zZSwgNTAwLCBlcnJvcilcblxuICAgICAgICB9XG5cbiAgICB9LFxuICAgXG4gICAgZGVsZXRlVG9rZW46IGFzeW5jIGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbnNlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgcmVmcmVzaFRva2Vucy5maWx0ZXIodG9rZW4gPT50b2tlbiAhPT0gcmVxdWVzdC5ib2R5KVxuICAgICAgICAgIFxuICAgICAgICAgICByZXNwb25zZS5zZW5kKFwibG9nb3V0IFN1Y2Nlc3NmdWxseVwiKVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgICAgIHJldHVybiBoZWxwZXIucmVzcG9uc2UocmVzcG9uc2UsIDUwMCwgZXJyb3IpXG5cbiAgICAgICAgfVxuXG4gICAgfVxufVxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiJdfQ==